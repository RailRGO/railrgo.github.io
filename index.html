<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Онлайн‑уроки | Запись на уроки по математике и физике</title>
  <meta name="description" content="Онлайн‑запись на индивидуальные уроки по математике и физике. Урок — 50 минут.">
  <link rel="canonical" href="https://railrgo.github.io/">

  <!-- Favicons -->
  <link rel="icon" href="favicon.svg" type="image/svg+xml" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="manifest" href="site.webmanifest">
  <link rel="mask-icon" href="safari-pinned-tab.svg" color="#6366f1">
  <meta name="theme-color" content="#0b1020">
  <meta name="msapplication-TileColor" content="#0b1020">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:locale" content="ru_RU">
  <meta property="og:site_name" content="Онлайн‑уроки">
  <meta property="og:title" content="Онлайн‑уроки по математике и физике">
  <meta property="og:description" content="Запишитесь на удобное время. Урок — 50 минут.">
  <meta property="og:url" content="https://railrgo.github.io/">
  <meta property="og:image" content="https://railrgo.github.io/og-image.png">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Онлайн‑уроки по математике и физике">
  <meta name="twitter:description" content="Запишитесь на удобное время. Урок — 50 минут.">
  <meta name="twitter:image" content="https://railrgo.github.io/og-image.png">

  <!-- Шрифт -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b1020; --text:#0f172a; --muted:#64748b; --card:#ffffff;
      --accent:#6366f1; --border:#e5e7eb; --ring:rgba(99,102,241,0.2)
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#0b1020; --text:#e5e7eb; --muted:#9aa5b1; --card:rgba(255,255,255,0.06); --border:rgba(255,255,255,0.12); --ring:rgba(99,102,241,0.6) }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:radial-gradient(1200px 600px at 100% -10%, rgba(99,102,241,.12), transparent 60%),
                 radial-gradient(1000px 500px at -10% 100%, rgba(37,99,235,.12), transparent 60%),
                 var(--bg);
    }
    header,section,footer{max-width:960px;margin:0 auto;padding:20px}
    header{
      position:sticky; top:0; z-index:10; backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(0,0,0,.06), transparent);
      display:flex; align-items:center; justify-content:space-between; gap:14px; flex-wrap:wrap; border-bottom:1px solid var(--border)
    }
    .brand{font-weight:800; letter-spacing:.2px}
    nav a{margin-left:16px; color:var(--text); text-decoration:none; font-weight:600; opacity:.9}
    nav a:hover{opacity:1}
    .btn{
      display:inline-flex; align-items:center; gap:8px;
      background:linear-gradient(135deg, var(--accent), #8b5cf6);
      color:#fff; padding:12px 18px; border-radius:12px; text-decoration:none; font-weight:700;
      border:0; cursor:pointer; box-shadow:0 8px 24px rgba(99,102,241,.25); transition:transform .12s ease, box-shadow .12s ease
    }
    .btn:hover{transform:translateY(-1px); box-shadow:0 12px 28px rgba(99,102,241,.35)}
    .card{
      background:var(--card); padding:22px; border-radius:16px; border:1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0,0,0,.08)
    }
    .grid{display:grid; gap:16px}
    .two{grid-template-columns:1fr 1fr}
    @media(max-width:720px){.two{grid-template-columns:1fr}}
    label{font-weight:600;font-size:14px;margin-bottom:6px;display:block}
    input,select{
      width:100%; padding:12px 14px; border:1px solid var(--border); border-radius:12px; color:var(--text);
      background:rgba(255,255,255,.9); outline:none; transition:border-color .15s, box-shadow .15s, background .15s
    }
    @media (prefers-color-scheme: dark){
      input,select{ background:rgba(255,255,255,.06) }
    }
    input:focus,select:focus{border-color:var(--accent); box-shadow:0 0 0 6px var(--ring)}
    .muted{color:var(--muted);font-size:14px}
    .success{background:#ecfdf5;color:#065f46;padding:12px;border-radius:12px}
    .error{background:#fef2f2;color:#991b1b;padding:12px;border-radius:12px}
    small.badge{background:#eef2ff;color:#3730a3;padding:2px 8px;border-radius:999px;font-weight:600}
    h1,h2{letter-spacing:.2px}

    /* Мягкое появление заголовка */
    .reveal{opacity:0; transform:translateY(8px); animation:fadeUp .6s ease-out .05s forwards}
    @keyframes fadeUp{to{opacity:1; transform:translateY(0)}}
  </style>
</head>
<body>
<header>
  <div class="brand">Онлайн‑уроки</div>
  <nav>
    <a href="#schedule">Запись</a>
    <a href="#contacts">Контакты</a>
  </nav>
</header>

<section class="card">
  <h1 class="reveal">Онлайн‑уроки по математике и физике</h1>
  <p class="muted">
    Один урок — 50 минут. Слоты показываются по московскому времени (МСК).
  </p>
  <p><a class="btn" href="#schedule">Записаться</a></p>
</section>

<section id="schedule">
  <h2>Запись на занятие</h2>
  <div class="card">
    <form id="bookingForm" class="grid" autocomplete="on">
      <div class="two grid">
        <div>
          <label for="name">Имя</label>
          <input id="name" name="name" required placeholder="Иван Иванов">
        </div>
        <div>
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required placeholder="name@example.com">
        </div>
      </div>

      <div class="two grid">
        <div>
          <label for="subject">Предмет</label>
          <select id="subject" name="subject">
            <option>Математика</option>
            <option>Физика</option>
          </select>
        </div>
        <div>
          <label for="date">Дата (по Москве)</label>
          <input id="date" name="date" type="date" required>
          <div class="muted">Выбирайте день; список времени ниже — по МСК.</div>
        </div>
      </div>

      <div>
        <label for="time">Время слота (МСК)</label>
        <select id="time" name="time" required></select>
        <div class="muted">Если слотов нет — выберите другую дату.</div>
      </div>

      <div id="status" aria-live="polite"></div>
      <div>
        <button class="btn" type="submit">Проверить и записаться</button>
      </div>
    </form>
  </div>
</section>

<section id="contacts">
  <h2>Контакты</h2>
  <div class="card">
    <p><a class="btn" style="background:#0088cc" href="https://t.me/aviation09" target="_blank" rel="noopener">Связаться в Telegram</a></p>
    <p class="muted">Приглашение придёт на указанный email автоматически.</p>
  </div>
</section>

<footer>
  <small>© 2025 Онлайн‑уроки</small>
</footer>

<script>
  // URL вашего Apps Script Web App (оканчивается на /exec)
  const GAS_URL = 'https://script.google.com/macros/s/AKfycbxJ-H7JnwPHRDyX2YZ1j_-cHLbwQ-Vh-2XTuXuS83jblHvvjUBwwyfsiCOEhB90GfPfTg/exec';

  const dateEl = document.getElementById('date');
  const timeEl = document.getElementById('time');
  const statusEl = document.getElementById('status');

  // Сегодня по Москве
  function todayMskYmd() {
    const fmt = new Intl.DateTimeFormat('en-CA', { timeZone: 'Europe/Moscow', year:'numeric', month:'2-digit', day:'2-digit' });
    return fmt.format(new Date());
  }
  dateEl.min = todayMskYmd();
  dateEl.value = todayMskYmd();

  dateEl.addEventListener('change', populateTimes);
  populateTimes();

  async function populateTimes() {
    timeEl.innerHTML = '';
    const ymd = dateEl.value;
    if (!ymd) return;
    showStatus('Загружаем слоты…', '');

    try {
      const res = await fetch(`${GAS_URL}?action=slots&date=${encodeURIComponent(ymd)}`);
      const data = await res.json();
      if (!data.ok) throw new Error(data.error || 'ошибка');

      if (!data.slots || data.slots.length === 0) {
        showStatus('На выбранную дату слоты отсутствуют.', 'error');
        return;
      }

      for (const s of data.slots) {
        const opt = document.createElement('option');
        opt.value = s.startIso;       // ISO UTC
        opt.textContent = s.label;    // "HH:mm МСК"
        timeEl.appendChild(opt);
      }
      showStatus('', '');
    } catch (e) {
      console.error(e);
      showStatus('Не удалось загрузить слоты. Обновите страницу позже.', 'error');
    }
  }

  document.getElementById('bookingForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    showStatus('Отправляем запрос…', '');

    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const subject = document.getElementById('subject').value.trim();
    const startIso = document.getElementById('time').value;

    if (!startIso) {
      showStatus('Выберите время слота', 'error');
      return;
    }

    const payload = { name, email, subject, startIso };

    try {
      const res = await fetch(GAS_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (!data.ok) {
        if (data.reason === 'busy') {
          showStatus('Этот слот уже занят. Пожалуйста, выберите другой.', 'error');
        } else if (data.reason === 'past') {
          showStatus('Нельзя записаться на прошедшее время. Выберите другой слот.', 'error');
        } else if (data.reason === 'closed') {
          showStatus('Слот недоступен. Выберите другое время.', 'error');
        } else {
          showStatus('Ошибка: ' + (data.error || 'неизвестно'), 'error');
        }
        return;
      }

      // Форматируем подтверждение по МСК, 24 часа
      const start = new Date(data.startIso);
      const mskLabel = start.toLocaleString('ru-RU', {
        timeZone: 'Europe/Moscow',
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit', hourCycle: 'h23'
      });

      showStatus(
        `Готово! Вы записаны на <b>${mskLabel} МСК</b> (50 минут).<br>
         Приглашение отправлено на <b>${email}</b>.`,
        'success'
      );

      e.target.reset();
      dateEl.value = todayMskYmd();
      populateTimes();
    } catch (err) {
      showStatus('Не удалось отправить заявку. Проверьте интернет и попробуйте снова.', 'error');
      console.error(err);
    }
  });

  function showStatus(html, type) {
    statusEl.className = type === 'error' ? 'error' : (type === 'success' ? 'success' : '');
    statusEl.innerHTML = html;
  }
</script>
</body>
</html>
