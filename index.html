<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Онлайн‑уроки | Запись на уроки по математике и физике</title>
  <meta name="description" content="Онлайн‑запись на индивидуальные уроки по математике и физике. Урок — 50 минут.">
  <link rel="canonical" href="https://railrgo.github.io/">

  <!-- Favicons -->
  <link rel="icon" href="favicon.svg" type="image/svg+xml" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="manifest" href="site.webmanifest">
  <link rel="mask-icon" href="safari-pinned-tab.svg" color="#6366f1">
  <meta name="theme-color" content="#0b1020">
  <meta name="msapplication-TileColor" content="#0b1020">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:locale" content="ru_RU">
  <meta property="og:site_name" content="Онлайн‑уроки">
  <meta property="og:title" content="Онлайн‑уроки по математике и физике">
  <meta property="og:description" content="Запишитесь на удобное время. Урок — 50 минут.">
  <meta property="og:url" content="https://railrgo.github.io/">
  <meta property="og:image" content="https://railrgo.github.io/og-image.png">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Онлайн‑уроки по математике и физике">
  <meta name="twitter:description" content="Запишитесь на удобное время. Урок — 50 минут.">
  <meta name="twitter:image" content="https://railrgo.github.io/og-image.png">

  <!-- Шрифт -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b1020; --text:#e5e7eb; --muted:#9aa5b1; --card:rgba(255,255,255,0.06);
      --accent:#6366f1; --border:rgba(255,255,255,0.12); --ring:rgba(99,102,241,0.6)
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f8fafc; --text:#1b1b1b; --muted:#6b7280; --card:#ffffff; --border:#e5e7eb; --ring:rgba(37,99,235,0.2); --accent:#2563eb }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text); background:radial-gradient(1200px 600px at 100% -10%, rgba(99,102,241,.15), transparent 60%),
                        radial-gradient(1000px 500px at -10% 100%, rgba(37,99,235,.15), transparent 60%),
                        var(--bg);
    }
    header,section,footer{max-width:960px;margin:0 auto;padding:20px}
    header{
      position:sticky; top:0; z-index:10; backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(0,0,0,.25), transparent);
      display:flex; align-items:center; justify-content:space-between; gap:14px; flex-wrap:wrap; border-bottom:1px solid var(--border)
    }
    .brand{font-weight:800; letter-spacing:.2px}
    nav a{margin-left:16px; color:var(--text); text-decoration:none; font-weight:600; opacity:.9}
    nav a:hover{opacity:1}
    .btn{
      display:inline-flex; align-items:center; gap:8px;
      background:linear-gradient(135deg, var(--accent), #8b5cf6);
      color:#fff; padding:12px 18px; border-radius:12px; text-decoration:none; font-weight:700;
      border:0; cursor:pointer; box-shadow:0 8px 24px rgba(99,102,241,.35); transition:transform .12s ease, box-shadow .12s ease
    }
    .btn:hover{transform:translateY(-1px); box-shadow:0 12px 28px rgba(99,102,241,.45)}
    .card{
      background:var(--card); padding:22px; border-radius:16px; border:1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0,0,0,.15)
    }
    .grid{display:grid; gap:16px}
    .two{grid-template-columns:1fr 1fr}
    @media(max-width:720px){.two{grid-template-columns:1fr}}
    label{font-weight:600;font-size:14px;margin-bottom:6px;display:block}
    input,select,textarea{
      width:100%; padding:12px 14px; border:1px solid var(--border); border-radius:12px; color:var(--text);
      background:rgba(255,255,255,.04); outline:none; transition:border-color .15s, box-shadow .15s, background .15s
    }
    input:focus,select:focus,textarea:focus{border-color:var(--accent); box-shadow:0 0 0 6px var(--ring); background:rgba(255,255,255,.06)}
    .muted{color:var(--muted);font-size:14px}
    .success{background:#ecfdf5;color:#065f46;padding:12px;border-radius:12px}
    .error{background:#fef2f2;color:#991b1b;padding:12px;border-radius:12px}
    small.badge{background:#eef2ff;color:#3730a3;padding:2px 8px;border-radius:999px;font-weight:600}
    h1,h2{letter-spacing:.2px}
  </style>
</head>
<body>
<header>
  <div class="brand">Онлайн‑уроки</div>
  <nav>
    <a href="#schedule">Запись</a>
    <a href="#about">О сервисе</a>
    <a href="#contacts">Контакты</a>
  </nav>
</header>

<section class="card">
  <h1>Онлайн‑уроки по математике и физике</h1>
  <p class="muted">
    Длительность занятия — 50 минут. Рабочие часы: пн–сб, 18:00–22:00 по Москве (Europe/Moscow).
    Слоты ниже отображаются в вашем часовом поясе.
  </p>
  <p><a class="btn" href="#schedule">Записаться</a></p>
</section>

<section id="schedule">
  <h2>Запись на занятие</h2>
  <div class="card">
    <form id="bookingForm" class="grid" autocomplete="on">
      <div class="two grid">
        <div>
          <label for="name">Имя</label>
          <input id="name" name="name" required placeholder="Иван Иванов">
        </div>
        <div>
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required placeholder="name@example.com">
        </div>
      </div>

      <div class="two grid">
        <div>
          <label for="subject">Предмет</label>
          <select id="subject" name="subject">
            <option>Математика</option>
            <option>Физика</option>
          </select>
        </div>
        <div>
          <label for="date">Дата (ваш часовой пояс: <span id="tzLabel"></span>)</label>
          <input id="date" name="date" type="date" required>
          <div class="muted">Учитываются рабочие дни (по Москве): пн–сб.</div>
        </div>
      </div>

      <div>
        <label for="time">Время слота</label>
        <select id="time" name="time" required></select>
        <div class="muted">Отображение: локальное время — эквивалент <b>18:00–22:00 МСК</b> выбранного дня.</div>
      </div>

      <div>
        <label for="message">Комментарий (необязательно)</label>
        <input id="message" name="message" placeholder="Пожелания по теме, уровень и т.д.">
      </div>

      <div id="status" aria-live="polite"></div>
      <div>
        <button class="btn" type="submit">Проверить и записаться</button>
      </div>
    </form>
  </div>
</section>

<section id="about">
  <h2>О сервисе</h2>
  <div class="card">
    <p>Индивидуальные онлайн‑уроки по математике и физике. Подготовка к экзаменам, помощь с текущей программой и углублённые занятия. Длительность одного урока — 50 минут.</p>
  </div>
</section>

<section id="contacts">
  <h2>Контакты</h2>
  <div class="card">
    <p><a class="btn" style="background:#0088cc" href="https://t.me/aviation09" target="_blank" rel="noopener">Связаться в Telegram</a></p>
    <p class="muted">Приглашение придёт на указанный email автоматически.</p>
  </div>
</section>

<footer>
  <small>© 2025 Онлайн‑уроки</small>
</footer>

<script>
  // URL вашего Apps Script Web App (замените при необходимости)
  const GAS_URL = 'https://script.google.com/macros/s/AKfycby5WBIws3oNiBguaQhb837aMm33bHXY5pqopXtQARaIMz6r-eXChE_raaOTLx8oZUrb0w/exec';

  // Настройки расписания (часы — по московскому времени)
  const SERVICE_TZ = 'Europe/Moscow';
  const WORK_DAYS = [1,2,3,4,5,6]; // 1=пн ... 7=вс — работаем пн–сб
  const START_HOUR = 18;            // 18:00 МСК
  const END_HOUR = 22;              // до 22:00 (последний старт — 21:00)
  const SLOT_DURATION_MIN = 50;

  const tzUser = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Local';
  document.getElementById('tzLabel').textContent = tzUser;

  const dateEl = document.getElementById('date');
  const timeEl = document.getElementById('time');
  const statusEl = document.getElementById('status');

  // Минимальная дата — сегодня
  const todayLocal = new Date();
  dateEl.min = toYmd(todayLocal);

  // Выбираем ближайшую допустимую дату (по расписанию в Москве)
  const initialLocal = nextAllowedLocalDate(todayLocal);
  dateEl.value = toYmd(initialLocal);

  dateEl.addEventListener('change', () => {
    const d = new Date(dateEl.value + 'T12:00:00');
    if (!isAllowedLocalDate(d)) {
      const next = nextAllowedLocalDate(d);
      dateEl.value = toYmd(next);
    }
    populateTimes();
  });

  populateTimes();

  function showStatus(html, type) {
    statusEl.className = type === 'error' ? 'error' : (type === 'success' ? 'success' : '');
    statusEl.innerHTML = html;
  }

  // Проверяем: является ли локальная дата допустимой по дню недели в московском времени
  function isAllowedLocalDate(localNoonDate) {
    const wk = weekdayNumInTZ(localNoonDate, SERVICE_TZ); // 1..7
    return WORK_DAYS.includes(wk);
  }

  function nextAllowedLocalDate(fromLocalDate) {
    const d = new Date(fromLocalDate);
    d.setHours(12,0,0,0); // полдень
    while (!isAllowedLocalDate(d) || toYmd(d) < toYmd(todayLocal)) {
      d.setDate(d.getDate() + 1);
    }
    return d;
  }

  function toYmd(d) {
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${dd}`;
  }

  function weekdayNumInTZ(dateLocal, tz) {
    const w = new Intl.DateTimeFormat('en-GB', { timeZone: tz, weekday: 'short' }).format(dateLocal);
    const map = {Mon:1, Tue:2, Wed:3, Thu:4, Fri:5, Sat:6, Sun:7};
    return map[w];
  }

  // Получить YYYY,MM,DD дня в МСК, соответствующего локальной дате
  function mskYmdFromLocalYmd(localYmd) {
    const localNoon = new Date(localYmd + 'T12:00:00');
    const y = Number(new Intl.DateTimeFormat('en-CA', { timeZone: SERVICE_TZ, year:'numeric' }).format(localNoon));
    const m = Number(new Intl.DateTimeFormat('en-CA', { timeZone: SERVICE_TZ, month:'2-digit' }).format(localNoon));
    const d = Number(new Intl.DateTimeFormat('en-CA', { timeZone: SERVICE_TZ, day:'2-digit' }).format(localNoon));
    return { y, m, d };
  }

  // Построить Date, представляющую момент y-m-d h:mm в часовом поясе tz (без библиотек)
  function makeZonedDate(y, m, d, hh, mm, tz) {
    const dtf = new Intl.DateTimeFormat('en-US', {
      timeZone: tz, hour12: false,
      year: 'numeric', month: '2-digit', day: '2-digit',
      hour: '2-digit', minute: '2-digit', second: '2-digit'
    });
    let utc = Date.UTC(y, m-1, d, hh, mm, 0);
    for (let i = 0; i < 3; i++) {
      const parts = Object.fromEntries(dtf.formatToParts(new Date(utc)).map(p => [p.type, p.value]));
      const ay = Number(parts.year), am = Number(parts.month), ad = Number(parts.day);
      const ah = Number(parts.hour), ami = Number(parts.minute), as = Number(parts.second);
      const desired = Date.UTC(y, m-1, d, hh, mm, 0);
      const actual  = Date.UTC(ay, am-1, ad, ah, ami, as);
      const diff = desired - actual;
      if (diff === 0) break;
      utc += diff;
    }
    return new Date(utc);
  }

  function populateTimes() {
    timeEl.innerHTML = '';
    const localYmd = dateEl.value;
    if (!localYmd) return;

    // День в МСК для выбранной локальной даты
    const { y, m, d } = mskYmdFromLocalYmd(localYmd);

    // Проверка рабочего дня в МСК
    const mskNoon = makeZonedDate(y, m, d, 12, 0, SERVICE_TZ);
    if (!WORK_DAYS.includes(weekdayNumInTZ(mskNoon, SERVICE_TZ))) {
      showStatus('В этот день (по МСК) запись не ведётся. Выбран ближайший доступный.', 'error');
      const next = nextAllowedLocalDate(new Date(localYmd + 'T12:00:00'));
      dateEl.value = toYmd(next);
      return populateTimes();
    }

    const now = new Date();
    let count = 0;
    for (let h = START_HOUR; h < END_HOUR; h++) {
      // Слот: h:00 по МСК → конвертируем в локальное время пользователя
      const slotStart = makeZonedDate(y, m, d, h, 0, SERVICE_TZ); // абсолютное время
      if (slotStart.getTime() < now.getTime() + 2*60000) continue; // прошедшие слоты скрываем

      const localLabel = slotStart.toLocaleTimeString([], { hour:'2-digit', minute:'2-digit' });
      const mskLabel = String(h).padStart(2,'0') + ':00 МСК';

      const opt = document.createElement('option');
      opt.value = slotStart.toISOString(); // отправляем ISO UTC
      opt.textContent = `${localLabel} (=${mskLabel})`;
      timeEl.appendChild(opt);
      count++;
    }

    if (!count) {
      showStatus('На выбранную дату (по МСК) свободных слотов не осталось. Выберите другой день.', 'error');
    } else {
      showStatus('', '');
    }
  }

  document.getElementById('bookingForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    showStatus('Отправляем запрос…', '');

    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const subject = document.getElementById('subject').value.trim();
    const message = document.getElementById('message').value.trim();
    const startIso = document.getElementById('time').value;

    if (!startIso) {
      showStatus('Выберите время слота', 'error');
      return;
    }

    const payload = { name, email, subject, message, startIso, timezone: tzUser };

    try {
      const res = await fetch(GAS_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain;charset=utf-8' }, // без preflight
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (!data.ok) {
        if (data.reason === 'busy') {
          showStatus('Это время уже занято. Пожалуйста, выберите другое.', 'error');
        } else if (data.reason === 'closed') {
          showStatus('Запись доступна пн–сб с 18:00 до 22:00 по Москве. Выберите другое время.', 'error');
        } else if (data.reason === 'past') {
          showStatus('Нельзя записаться на прошедшее время. Выберите другой слот.', 'error');
        } else {
          showStatus('Ошибка: ' + (data.error || 'неизвестно'), 'error');
        }
        return;
      }

      const start = new Date(data.startIso);

      showStatus(
        `Готово! Вы записаны на <b>${start.toLocaleString()}</b> (50 минут).<br>
         Приглашение отправлено на <b>${email}</b> (проверьте «Входящие/Спам»).<br><br>
         <small class="badge">Управление записью</small><br>
         <a href="${data.cancelUrl}" target="_blank" rel="noopener">Отменить запись</a>`,
        'success'
      );

      e.target.reset();
      populateTimes();
    } catch (err) {
      showStatus('Не удалось отправить заявку. Проверьте интернет и попробуйте снова.', 'error');
      console.error(err);
    }
  });
</script>
</body>
</html>



