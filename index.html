<!DOCTYPE html>
<html lang="ru" data-theme="">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Онлайн‑уроки | Запись на уроки по математике и физике</title>
  <meta name="description" content="Онлайн‑запись на индивидуальные уроки по математике и физике. Урок — 50 минут.">
  <link rel="canonical" href="https://railrgo.github.io/">

  <link rel="icon" href="favicon.svg" type="image/svg+xml" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="manifest" href="site.webmanifest">
  <link rel="mask-icon" href="safari-pinned-tab.svg" color="#6366f1">
  <meta name="theme-color" content="#0b1020">
  <meta name="msapplication-TileColor" content="#0b1020">

  <meta property="og:type" content="website">
  <meta property="og:locale" content="ru_RU">
  <meta property="og:site_name" content="Онлайн‑уроки">
  <meta property="og:title" content="Онлайн‑уроки по математике и физике">
  <meta property="og:description" content="Запишитесь на удобное время. Урок — 50 минут.">
  <meta property="og:url" content="https://railrgo.github.io/">
  <meta property="og:image" content="https://railrgo.github.io/og-image.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f8fafc; --text:#0f172a; --muted:#475569; --card:#ffffff;
      --accent:#6366f1; --border:#e5e7eb; --ring:rgba(99,102,241,0.2);
      --shadow: 0 10px 30px rgba(2,6,23,0.08);
      --btn-grad: linear-gradient(135deg, var(--accent), #8b5cf6);
      color-scheme: light;
    }
    [data-theme="dark"]{
      --bg:#0b1020; --text:#e5e7eb; --muted:#9aa5b1; --card:rgba(255,255,255,0.06);
      --border:rgba(255,255,255,0.12); --ring:rgba(99,102,241,0.5);
      --shadow: 0 12px 32px rgba(0,0,0,0.35);
      color-scheme: dark;
    }
    @media (prefers-color-scheme: dark){
      :root:not([data-theme="light"]){
        --bg:#0b1020; --text:#e5e7eb; --muted:#9aa5b1; --card:rgba(255,255,255,0.06);
        --border:rgba(255,255,255,0.12); --ring:rgba(99,102,241,0.5);
        --shadow: 0 12px 32px rgba(0,0,0,0.35);
        color-scheme: dark;
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
      background:
        radial-gradient(900px 500px at 110% -10%, rgba(99,102,241,.10), transparent 60%),
        radial-gradient(700px 350px at -10% 110%, rgba(37,99,235,.10), transparent 60%),
        var(--bg);
      transition: background-color .2s ease, color .2s ease;
    }

    header,section,footer{max-width:960px;margin:0 auto;padding:20px}
    .padless{padding-left:0; padding-right:0}

    header{
      position:sticky; top:0; z-index:10;
      background: color-mix(in srgb, var(--bg) 92%, transparent);
      backdrop-filter: blur(8px);
      display:flex; align-items:center; justify-content:space-between; gap:14px; flex-wrap:wrap;
      border-bottom:1px solid var(--border)
    }
    .brand{font-weight:800; letter-spacing:.2px}
    nav{display:flex; align-items:center; gap:16px}
    nav a{color:var(--text); text-decoration:none; font-weight:600}

    .toggle{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border:1px solid var(--border);
      border-radius:10px; background:var(--card); color:var(--text); cursor:pointer; font-weight:600;
      box-shadow: var(--shadow); transition:filter .12s ease, transform .12s ease; user-select:none;
    }
    .toggle:hover{transform:translateY(-1px)}
    .toggle svg{width:18px;height:18px}

    .btn{
      display:inline-flex; align-items:center; gap:8px;
      background:var(--btn-grad);
      color:#fff; padding:12px 18px; border-radius:12px; text-decoration:none !important; font-weight:700;
      border:0; cursor:pointer; box-shadow:0 8px 24px rgba(99,102,241,.25);
      transition:transform .12s ease, box-shadow .12s ease;
      font-size:16px; line-height:1;
    }
    .btn:hover{transform:translateY(-1px); box-shadow:0 12px 28px rgba(99,102,241,.35)}
    .btn:disabled{opacity:.7; cursor:not-allowed}

    .card{ background:var(--card); padding:24px; border-radius:16px; border:1px solid var(--border); box-shadow: var(--shadow) }
    section.card{ margin-top:16px }

    .grid{display:grid; gap:16px}
    .two{grid-template-columns:1fr 1fr}
    @media(max-width:720px){.two{grid-template-columns:1fr}}

    .hidden{display:none !important}

    label{font-weight:600;font-size:14px;margin-bottom:6px;display:block}
    input,select{
      width:100%; padding:12px 14px; border:1px solid var(--border); border-radius:12px; color:var(--text);
      background:var(--card); outline:none; transition:border-color .15s, box-shadow .15s
    }
    input:focus,select:focus{border-color:var(--accent); box-shadow:0 0 0 6px var(--ring)}
    input::placeholder{ color:var(--muted); opacity:.9 }

    select{
      appearance:none; -webkit-appearance:none; -moz-appearance:none;
      padding-right:40px;
      background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%236366f1'%3E%3Cpath d='M5.5 7.5l4.5 4.5 4.5-4.5'/%3E%3C/svg%3E");
      background-repeat:no-repeat; background-position:right 12px center; background-size:16px 16px;
    }
    [data-theme="dark"] select{
      background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%239aa5b1'%3E%3Cpath d='M5.5 7.5l4.5 4.5 4.5-4.5'/%3E%3C/svg%3E");
    }
    select option{ background-color:var(--card); color:var(--text) }
    select:disabled{ opacity:.6; cursor:not-allowed }

    .muted{color:var(--muted);font-size:14px}

    #status{margin-top:8px}
    .success{background:#ecfdf5;color:#065f46;padding:12px;border-radius:12px}
    .error{background:#fee2e2;color:#991b1b;padding:12px;border-radius:12px}
    .loading{display:inline-flex; align-items:center; gap:10px; color:var(--muted); font-size:14px}
    .spinner{width:16px; height:16px; border-radius:50%; border:2px solid var(--border); border-top-color:var(--accent); animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    h1,h2{letter-spacing:.2px;margin:0 0 10px}
    footer{ text-align:center; color:var(--muted) }
  </style>
</head>
<body>
<header>
  <div class="brand">Онлайн‑уроки</div>
  <nav>
    <a href="#schedule">Запись</a>
    <a href="#contacts">Контакты</a>
    <button id="themeToggle" class="toggle" type="button" aria-pressed="false" title="Переключить тему">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.36 6.36-1.42-1.42M7.05 7.05 5.64 5.64m12.02 0-1.41 1.41M7.05 16.95l-1.41 1.41"/>
        <circle cx="12" cy="12" r="4"/>
      </svg>
      <span id="themeLabel">Тема</span>
    </button>
  </nav>
</header>

<section class="card">
  <h1>Онлайн‑уроки по математике и физике</h1>
  <p class="muted" style="max-width:720px">
    Индивидуальные занятия по договорённости. Один урок — 50 минут.<br>
    Свободные окна указаны по московскому времени (МСК).
  </p>
  <p><a class="btn" href="#schedule">Записаться</a></p>
</section>

<section id="schedule" class="padless">
  <h2 style="padding:0 20px">Запись на занятие</h2>
  <div class="card">
    <form id="bookingForm" class="grid" autocomplete="on">
      <div class="two grid">
        <div>
          <label for="name">Имя</label>
          <input id="name" name="name" required placeholder="Иван Иванов">
        </div>
        <div>
          <label for="email">Email</label>
          <input id="email" name="email" type="email" placeholder="name@example.com">
        </div>
      </div>

      <div class="two grid">
        <div>
          <label for="subject">Предмет</label>
          <select id="subject" name="subject">
            <option>Математика</option>
            <option>Физика</option>
          </select>
        </div>
        <div>
          <label for="date">Дата (по Москве)</label>
          <input id="date" name="date" type="date" required>
          <div class="muted">Список времени ниже — по МСК.</div>
        </div>
      </div>

      <div>
        <label for="time">Время слота (МСК)</label>
        <select id="time" name="time" required disabled></select>
        <div class="muted">Если слотов нет — выберите другую дату.</div>
      </div>

      <div class="two grid">
        <div>
          <label for="channel">Куда прислать уведомление?</label>
          <select id="channel" name="channel">
            <option value="email">Email</option>
            <option value="telegram">Telegram</option>
          </select>
        </div>
        <div id="tgFields" class="hidden">
          <label for="phone">Телефон для Telegram (+7…)</label>
          <input id="phone" name="phone" type="tel" placeholder="+7 999 123-45-67">
          <div class="muted">На этот номер придёт уведомление в Telegram.</div>
        </div>
      </div>

      <div id="status" aria-live="polite"></div>
      <div>
        <button class="btn" type="submit">Проверить и записаться</button>
      </div>
    </form>
  </div>
</section>

<section id="contacts" class="padless">
  <h2 style="padding:0 20px">Контакты</h2>
  <div class="card">
    <p><a class="btn" style="background:#0088cc" href="https://t.me/aviation09" target="_blank" rel="noopener">Связаться в Telegram</a></p>
    <p class="muted">Приглашение (если выбран Email) придёт на указанный адрес автоматически.</p>
  </div>
</section>

<footer>
  <small>© 2025 Онлайн‑уроки. Все права защищены</small>
</footer>

<script>
  // Текущий Web App URL (оканчивается на /exec)
  const GAS_URL = 'https://script.google.com/macros/s/AKfycbwnADOj06shMn9LhvyIfo6zf7W5cL3VJg6mECXGpIiqQBLfdG-KIGLPxpPHT63j5Bc5rw/exec';

  // Тема
  const themeBtn = document.getElementById('themeToggle');
  const themeLabel = document.getElementById('themeLabel');
  initTheme();
  function initTheme(){
    const saved = localStorage.getItem('theme');
    const systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const theme = saved || (systemDark ? 'dark' : 'light');
    setTheme(theme);
  }
  function setTheme(mode){
    document.documentElement.setAttribute('data-theme', mode);
    localStorage.setItem('theme', mode);
    const isDark = mode === 'dark';
    themeBtn.setAttribute('aria-pressed', isDark ? 'true' : 'false');
    themeLabel.textContent = isDark ? 'Тёмная тема' : 'Светлая тема';
    themeBtn.querySelector('svg').innerHTML = isDark
      ? '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z"></path>'
      : '<path d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.36 6.36-1.42-1.42M7.05 7.05 5.64 5.64m12.02 0-1.41 1.41M7.05 16.95l-1.41 1.41"></path><circle cx="12" cy="12" r="4"></circle>';
  }
  themeBtn.addEventListener('click', () => {
    const current = document.documentElement.getAttribute('data-theme') || 'light';
    setTheme(current === 'dark' ? 'light' : 'dark');
  });

  // Элементы формы
  const dateEl = document.getElementById('date');
  const timeEl = document.getElementById('time');
  const statusEl = document.getElementById('status');
  const emailEl = document.getElementById('email');
  const channelEl = document.getElementById('channel');
  const tgFields = document.getElementById('tgFields');
  const phoneEl = document.getElementById('phone');

  let statusLockUntil = 0;

  function todayMskYmd() {
    const fmt = new Intl.DateTimeFormat('en-CA', { timeZone: 'Europe/Moscow', year:'numeric', month:'2-digit', day:'2-digit' });
    return fmt.format(new Date());
  }
  dateEl.min = todayMskYmd();
  initDate();

  async function initDate() {
    try {
      const res = await fetch(`${GAS_URL}?action=nextOpenDate`);
      const data = await res.json();
      dateEl.value = (data.ok && data.date) ? data.date : todayMskYmd();
    } catch {
      dateEl.value = todayMskYmd();
    }
    populateTimes();
  }

  dateEl.addEventListener('change', populateTimes);
  channelEl.addEventListener('change', updateChannelUI);

  function updateChannelUI(){
    const ch = channelEl.value;
    const isTg = ch === 'telegram';
    tgFields.classList.toggle('hidden', !isTg);
    phoneEl.required = isTg;
    emailEl.required = !isTg;
  }
  function normalizePhoneLocal(s){
    const digits = String(s||'').replace(/\D/g,'');
    if (!digits) return '';
    let d = digits;
    if (d.length === 11 && d.startsWith('8')) d = '7' + d.slice(1);
    return '+' + d;
  }
  updateChannelUI();

  async function populateTimes() {
    timeEl.innerHTML = '';
    timeEl.disabled = true;
    const ymd = dateEl.value;
    if (!ymd) return;
    showLoading('Загружаем слоты…');

    try {
      const res = await fetch(`${GAS_URL}?action=slots&date=${encodeURIComponent(ymd)}`);
      const data = await res.json();
      if (!data.ok) throw new Error(data.error || 'ошибка');

      if (!data.slots || data.slots.length === 0) {
        showStatus('На выбранную дату слоты отсутствуют.', 'error'); return;
      }

      for (const s of data.slots) {
        const opt = document.createElement('option');
        opt.value = s.startIso;
        opt.textContent = s.label;
        timeEl.appendChild(opt);
      }
      timeEl.disabled = false;
      showStatus('', '');
    } catch (e) {
      console.error(e);
      showStatus('Не удалось загрузить слоты. Обновите страницу позже.', 'error');
    }
  }

  document.getElementById('bookingForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    showLoading('Отправляем запрос…');

    const name = document.getElementById('name').value.trim();
    const email = emailEl.value.trim();
    const subject = document.getElementById('subject').value.trim();
    const startIso = document.getElementById('time').value;
    const channel = channelEl.value;
    const phoneRaw = phoneEl.value.trim();
    const phone = channel === 'telegram' ? normalizePhoneLocal(phoneRaw) : '';

    if (!startIso) { showStatus('Выберите время слота', 'error'); return; }
    if (channel === 'email' && !email) { showStatus('Укажите email или выберите Telegram.', 'error'); return; }
    if (channel === 'telegram' && !phone) { showStatus('Укажите телефон в формате +7… для Telegram.', 'error'); return; }

    const payload = { name, email, subject, startIso, channel, phone };
    try {
      const res = await fetch(GAS_URL, { method: 'POST', headers: { 'Content-Type': 'text/plain;charset=utf-8' }, body: JSON.stringify(payload) });
      const data = await res.json();

      if (!data.ok) {
        const map = { busy:'Этот слот уже занят. Пожалуйста, выберите другой.', past:'Нельзя записаться на прошедшее время.', closed:'Слот недоступен. Выберите другое время.' };
        showStatus(map[data.reason] || ('Ошибка: ' + (data.error || 'неизвестно')), 'error'); return;
      }

      const start = new Date(data.startIso);
      const mskLabel = start.toLocaleString('ru-RU', { timeZone: 'Europe/Moscow', year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hourCycle: 'h23' });

      let extra = '';
      if (data.channel === 'telegram' && data.tme) {
        extra = `<br><br><b>Важно:</b> чтобы получать напоминания в Telegram, <a href="${data.tme}" target="_blank" rel="noopener"><b>активируйте бота по этой ссылке</b></a>.`;
      } else if (data.channel === 'email') {
        extra = `<br><br>Приглашение отправлено на <b>${email}</b>.`;
        if (data.tme) {
          extra += `<br><br><b>P. S.</b> Вы также можете получать напоминания в Telegram. Для этого <a href="${data.tme}" target="_blank" rel="noopener"><b>активируйте бота по этой ссылке</b></a>.`;
        }
      }

      showStatus(`Готово! Вы записаны на <b>${mskLabel} МСК</b> (50 минут).${extra}`, 'success', { stickyMs: 15000 });

      setTimeout(() => {
        e.target.reset();
        updateChannelUI();
        initDate();
        setTimeout(() => showStatus('', ''), 500);
      }, 15200);

    } catch (err) {
      console.error(err);
      showStatus('Не удалось отправить заявку. Проверьте интернет и попробуйте снова.', 'error');
    }
  });

  function showLoading(text){
    if (Date.now() < statusLockUntil) return;
    statusEl.className = 'loading';
    statusEl.innerHTML = `<span class="spinner" aria-hidden="true"></span><span>${text}</span>`;
  }
  function showStatus(html, type, opts) {
    opts = opts || {};
    if (!html) {
      if (Date.now() < statusLockUntil) return;
      statusEl.className = '';
      statusEl.innerHTML = '';
      return;
    }
    statusEl.className = type === 'error' ? 'error' : (type === 'success' ? 'success' : '');
    statusEl.innerHTML = html;
    if (opts.stickyMs) statusLockUntil = Date.now() + opts.stickyMs;
  }
</script>
</body>
</html>

